BBPATH .= ":${LAYERDIR}"

BBFILES += "\
            ${LAYERDIR}/recipes-*/*/*.bb \
            ${LAYERDIR}/recipes-*/*/*.bbappend \
           "

BBFILE_COLLECTIONS += "wpe-layer"
BBFILE_PATTERN_wpe-layer := "^${LAYERDIR}/"
BBFILE_PRIORITY_wpe-layer = "20"

LAYERDEPENDS_wpe-layer = "core \
                          openembedded-layer \
                          multimedia-layer \
                          networking-layer \
                          meta-python \
                         "

LICENSE_PATH += "${LAYERDIR}/licenses"

# WPE needs mpg123 gstreamer plugin
LICENSE_FLAGS_WHITELIST += "commercial_mpg123"
LICENSE_FLAGS_WHITELIST += "commercial_gstreamer1.0-plugins-ugly"

# WPE on rpi needs the OpenMAX gstreamer plugin
LICENSE_FLAGS_WHITELIST += "commercial_libomxil"
LICENSE_FLAGS_WHITELIST += "commercial_gstreamer1.0-omx"

BB_DANGLINGAPPENDS_WARNONLY ?= "1"

#########################################################################################
# Boot settings
#
# disable_splash: If set to 1, the rainbow splash screen will not be
#                 shown on boot. The default value is 0.
#
# boot_delay: Instructs to wait for a given number of seconds in start.elf before
#             loading the kernel. The default value is 1.
#
# Source:
# https://www.raspberrypi.org/documentation/configuration/config-txt/boot.md

DISABLE_SPLASH ?= "1"
BOOT_DELAY ?= "0"

#########################################################################################
# Video settings
#
# hdmi_group: Defines the HDMI output group to be either CEA (Consumer Electronics
#             Association, the standard typically used by TVs) or DMT (Display
#             Monitor Timings, the standard typically used by monitors).
#
#             Value  Result
#             0      Auto-detect from EDID
#             1      CEA
#             2      DMT
#
# hdmi_mode: Defines the HDMI output format. Common values for CEA group below.
#            More values for CEA and DMT are in the source document.
#
#             Value  Resolution  Refresh
#             4      720p        60Hz
#             16     1080p       60Hz
#             19     720p        50Hz
#             31     1080p       50Hz
#
# disable_overscan: Set to 1 to disable overscan.
#
# Source:
# https://www.raspberrypi.org/documentation/configuration/config-txt/video.md

HDMI_GROUP ?= "1"
HDMI_MODE ?= "4"
DISABLE_OVERSCAN ?= "1"

#########################################################################################
# Overclocking settings
#
# arm_freq: Frequency of the ARM CPU in MHz.
#           The default value is 1000 for the Pi Zero and Pi Zero W,
#           700 for Pi 1, 900 for Pi 2, 1200 for the Pi 3.
#
# gpu_freq: Sets core_freq, h264_freq, isp_freq, and v3d_freq together.
#           On Pi 1/Pi 2 the default value is 250 for all items,
#           on Pi 3/Pi Zero /Pi Zero W core_freq defaults to 400 and
#           h264_freq, isp_freq and v3d_freqdefault to 300.
#
# sdram_freq: Frequency of the SDRAM in MHz.
#             The default value is 400 for the Pi 1 and Pi 2,
#             450 on the Pi 3, Pi Zero and Pi Zero W.
#
# over_voltage: CPU/GPU core voltage adjustment.
#               The defaults are in the table below.
#
#               Model       Default Overvoltage  Setting
#               Pi 1        1.2V                 0
#               Pi 2        1.2-1.3125V          0
#               Pi 3        1.2-1.3125V          0
#               Pi Zero(W)  1.35V                6
#
# Source:
# https://www.raspberrypi.org/documentation/configuration/config-txt/overclocking.md

# Raspberry Pi Zero
ARM_FREQ_raspberrypi0 ?= "1000"
GPU_FREQ_raspberrypi0 ?= "500"
SDRAM_FREQ_raspberrypi0 ?= "500"
OVER_VOLTAGE_raspberrypi0 ?= "6"

# Raspberry Pi Zero W
ARM_FREQ_raspberrypi0-wifi ?= "1000"
GPU_FREQ_raspberrypi0-wifi ?= "500"
SDRAM_FREQ_raspberrypi0-wifi ?= "500"
OVER_VOLTAGE_raspberrypi0-wifi ?= "6"

# Raspberry Pi (original)
ARM_FREQ_raspberrypi ?= "1000"
GPU_FREQ_raspberrypi ?= "500"
SDRAM_FREQ_raspberrypi ?= "500"
OVER_VOLTAGE_raspberrypi ?= "6"

# Raspberry Pi 2
ARM_FREQ_raspberrypi2 ?= "1000"
GPU_FREQ_raspberrypi2 ?= "500"
SDRAM_FREQ_raspberrypi2 ?= "500"
OVER_VOLTAGE_raspberrypi2 ?= "6"

#########################################################################################
# GPU/CPU memory split options
#
# gpu_mem_256: Sets the GPU memory in megabytes for the 256MB models.
#              The maximum value is 192 and the default is not set.
#
# gpu_mem_512: Sets the GPU memory in megabytes for the 512MB models.
#              The maximum value is 448 and the default is not set.
#
# gpu_mem_1024: Sets the GPU memory in megabytes for the 1024MB models.
#               The maximum value is 944 and the default is not set.
#
# Source:
# https://www.raspberrypi.org/documentation/configuration/config-txt/memory.md

GPU_MEM_256 ?= "128"
GPU_MEM_512 ?= "196"
GPU_MEM_1024 ?= "396"

#########################################################################################
# initramfs bits for rpi builds

#INITRAMFS_IMAGE_BUNDLE_rpi = "1"
#INITRAMFS_IMAGE_rpi = "wpe-initramfs-image"
#KERNEL_INITRAMFS = "-initramfs"
# Enlarge boot partition to 160MiB
#BOOT_SPACE = "163840"
