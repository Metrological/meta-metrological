# Provides the WPE Compositor plugin & client settings

# Additional flags
WPE_COMPOSITOR_AUTOSTART     ??= "true"
WPE_COMPOSITOR_OUTOFPROCESS  ??= "true"
WPE_COMPOSITOR_RESOLUTION    ??= "720p"

# Additional flags for Nexus implementations
# ----------------------------------------------------------------------------
WPE_COMPOSITOR_MEMORY_CLIENT      ??= ""
WPE_COMPOSITOR_MEMORY_GFX         ??= ""
WPE_COMPOSITOR_MEMORY_GFX2        ??= ""
WPE_COMPOSITOR_MEMORY_EXPORT      ??= ""
WPE_COMPOSITOR_MEMORY_MAIN        ??= ""
WPE_COMPOSITOR_MEMORY_RESTRICTED  ??= ""
WPE_COMPOSITOR_MEMORY_SECURE_GFX  ??= ""
WPE_COMPOSITOR_ALLOWED_CLIENTS    ??= ""
WPE_COMPOSITOR_ALLOW_UNAUTHENTICATED_CLIENTS ??= ""
WPE_COMPOSITOR_AUTHENTICATION     ??= ""
WPE_COMPOSITOR_BOXMODE            ??= "3"
WPE_COMPOSITOR_FRAMEBUFFER_WIDTH  ??= ""
WPE_COMPOSITOR_FRAMEBUFFER_HEIGHT ??= ""
WPE_COMPOSITOR_HARDWAREREADY      ??= "0"
WPE_COMPOSITOR_IRMODE             ??= "NEXUS_IrInputMode_eCirGISat"
WPE_COMPOSITOR_SVP                ??= "None"
WPE_COMPOSITOR_DRM_PATH           ??= ""
WPE_COMPOSITOR_PAK_PATH           ??= ""
WPE_COMPOSITOR_SAGE_PATH          ??= ""
WPE_COMPOSITOR_HDCP_LEVEL         ??= ""
WPE_COMPOSITOR_HDCP_VERSION       ??= ""
WPE_COMPOSITOR_HDCP1XBIN_PATH     ??= ""
WPE_COMPOSITOR_HDCP2XBIN_PATH     ??= ""
WPE_COMPOSITOR_LOUDNESS_MODE      ??= ""

# Implementation repo details
WPE_COMPOSITOR_IMPLEMENTATION_PATH             ??= ""
WPE_COMPOSITOR_IMPLEMENTATION_REPOSITORY       ??= "https://code.rdkcentral.com/r/soc/broadcom/components/rdkcentral/thundernanoservices/Compositor"
WPE_COMPOSITOR_IMPLEMENTATION_VERSION          ??= "master"
WPE_COMPOSITORCLIENT_IMPLEMENTATION_PATH       ??= ""
WPE_COMPOSITORCLIENT_IMPLEMENTATION_REPOSITORY ??= "https://code.rdkcentral.com/r/soc/broadcom/components/rdkcentral/thunder/compositorclient"
WPE_COMPOSITORCLIENT_IMPLEMENTATION_VERSION    ??= "master"


# Additional flags for Wayland implementations
# ----------------------------------------------------------------------------
WPE_COMPOSITOR_VIRTUALINPUT  ??= "ON"
WPE_COMPOSITOR_CURSOR_FILE   ??= ""

# Choose westeros or weston dependency
WPE_COMPOSITOR_WAYLAND_SUB_IMPL ??= "Westeros"
WPE_COMPOSITOR_WAYLAND_DEP      ??= "westeros"

# Repo details
WPE_COMPOSITOR_WAYLAND_IMPLEMENTATION_PATH       ??= ""
WPE_COMPOSITOR_WAYLAND_IMPLEMENTATION_REPOSITORY ??="https://code.rdkcentral.com/r/soc/broadcom/components/rdkcentral/thundernanoservices/Compositor"
WPE_COMPOSITOR_WAYLAND_IMPLEMENTATION_VERSION    ??= "master"

# ----------------------------------------------------------------------------
PACKAGECONFIG[compositor] = "-DPLUGIN_COMPOSITOR=ON \
    -DPLUGIN_COMPOSITOR_AUTOSTART=${WPE_COMPOSITOR_AUTOSTART} \
    -DPLUGIN_COMPOSITOR_OUTOFPROCESS=${WPE_COMPOSITOR_OUTOFPROCESS} \
    -DPLUGIN_COMPOSITOR_RESOLUTION=${WPE_COMPOSITOR_RESOLUTION} \
    ,-DPLUGIN_COMPOSITOR=OFF,wpeframework-clientlibraries"

PACKAGECONFIG[compositor_rpi]       = "-DPLUGIN_COMPOSITOR_IMPLEMENTATION='RPI',,"

PACKAGECONFIG[compositor_wayland] = "-DPLUGIN_COMPOSITOR_IMPLEMENTATION='Wayland' \
    -DCOMPOSITOR_WAYLAND_IMPLEMENTATION_PATH=${WPE_COMPOSITOR_WAYLAND_IMPLEMENTATION_PATH} \
    -DCOMPOSITOR_WAYLAND_IMPLEMENTATION_REPOSITORY=${WPE_COMPOSITOR_WAYLAND_IMPLEMENTATION_REPOSITORY} \
    -DCOMPOSITOR_WAYLAND_IMPLEMENTATION_VERSION=${WPE_COMPOSITOR_WAYLAND_IMPLEMENTATION_VERSION} \
    -DPLUGIN_COMPOSITOR_SUB_IMPLEMENTATION=${WPE_COMPOSITOR_WAYLAND_SUB_IMPL} \
    -DPLUGIN_COMPOSITOR_CURSOR_FILE=${WPE_COMPOSITOR_CURSOR_FILE} \
    -DPLUGIN_COMPOSITOR_VIRTUALINPUT=${WPE_COMPOSITOR_VIRTUALINPUT},,${WPE_COMPOSITOR_WAYLAND_DEP}"

PACKAGECONFIG[compositor_nexus]   = "-DPLUGIN_COMPOSITOR_IMPLEMENTATION='Nexus' \
    -DCOMPOSITOR_IMPLEMENTATION_PATH=${WPE_COMPOSITOR_IMPLEMENTATION_PATH} \
    -DCOMPOSITOR_IMPLEMENTATION_REPOSITORY=${WPE_COMPOSITOR_IMPLEMENTATION_REPOSITORY} \
    -DCOMPOSITOR_IMPLEMENTATION_VERSION=${WPE_COMPOSITOR_IMPLEMENTATION_VERSION} \
    -DPLUGIN_COMPOSITOR_ALLOWED_CLIENTS=${WPE_COMPOSITOR_ALLOWED_CLIENTS} \
    -DPLUGIN_COMPOSITOR_HARDWAREREADY=${WPE_COMPOSITOR_HARDWAREREADY},,"

PACKAGECONFIG[compositor_nexusserver] = "-DPLUGIN_COMPOSITOR_NXSERVER=ON \
    -DPLUGIN_COMPOSITOR_MEMORY_CLIENT=${WPE_COMPOSITOR_MEMORY_CLIENT} \
    -DPLUGIN_COMPOSITOR_MEMORY_GFX=${WPE_COMPOSITOR_MEMORY_GFX} \
    -DPLUGIN_COMPOSITOR_MEMORY_GFX2=${WPE_COMPOSITOR_MEMORY_GFX2} \
    -DPLUGIN_COMPOSITOR_MEMORY_EXPORT=${WPE_COMPOSITOR_MEMORY_EXPORT} \
    -DPLUGIN_COMPOSITOR_MEMORY_MAIN=${WPE_COMPOSITOR_MEMORY_MAIN} \
    -DPLUGIN_COMPOSITOR_MEMORY_RESTRICTED=${WPE_COMPOSITOR_MEMORY_RESTRICTED} \
    -DPLUGIN_COMPOSITOR_MEMORY_SECURE_GFX=${WPE_COMPOSITOR_MEMORY_SECURE_GFX} \
    -DPLUGIN_COMPOSITOR_DRM_PATH=${WPE_COMPOSITOR_DRM_PATH} \
    -DPLUGIN_COMPOSITOR_PAK_PATH=${WPE_COMPOSITOR_PAK_PATH} \
    -DPLUGIN_COMPOSITOR_SAGE_PATH=${WPE_COMPOSITOR_SAGE_PATH} \
    -DPLUGIN_COMPOSITOR_HDCP_LEVEL=${WPE_COMPOSITOR_HDCP_LEVEL} \
    -DPLUGIN_COMPOSITOR_HDCP_VERSION=${WPE_COMPOSITOR_HDCP_VERSION} \
    -DPLUGIN_COMPOSITOR_HDCP1XBIN_PATH=${WPE_COMPOSITOR_HDCP1XBIN_PATH} \
    -DPLUGIN_COMPOSITOR_HDCP2XBIN_PATH=${WPE_COMPOSITOR_HDCP2XBIN_PATH} \
    -DPLUGIN_COMPOSITOR_LOUDNESS_MODE=${WPE_COMPOSITOR_LOUDNESS_MODE} \
    -DPLUGIN_COMPOSITOR_ALLOW_UNAUTHENTICATED_CLIENTS=${WPE_COMPOSITOR_ALLOW_UNAUTHENTICATED_CLIENTS} \
    -DPLUGIN_COMPOSITOR_AUTHENTICATION=${WPE_COMPOSITOR_AUTHENTICATION} \
    -DPLUGIN_COMPOSITOR_BOXMODE=${WPE_COMPOSITOR_BOXMODE} \
    -DPLUGIN_COMPOSITOR_FRAMEBUFFER_WIDTH=${WPE_COMPOSITOR_FRAMEBUFFER_WIDTH} \
    -DPLUGIN_COMPOSITOR_FRAMEBUFFER_HEIGHT=${WPE_COMPOSITOR_FRAMEBUFFER_HEIGHT} \
    -DPLUGIN_COMPOSITOR_IRMODE=${WPE_COMPOSITOR_IRMODE} \
    -DPLUGIN_COMPOSITOR_SVP=${WPE_COMPOSITOR_SVP} \
    ,-DPLUGIN_COMPOSITOR_NXSERVER=OFF,"

PACKAGECONFIG[compositorclient] = "-DCOMPOSITORCLIENT=ON,-DCOMPOSITORCLIENT=OFF"
PACKAGECONFIG[compositorclient_rpi] = "-DPLUGIN_COMPOSITOR_IMPLEMENTATION='RPI',,"
PACKAGECONFIG[compositorclient_wayland] = "-DPLUGIN_COMPOSITOR_IMPLEMENTATION='Wayland' \
    -DPLUGIN_COMPOSITOR_SUB_IMPLEMENTATION=${WPE_COMPOSITOR_WAYLAND_SUB_IMPL},,${WPE_COMPOSITOR_WAYLAND_DEP}"
PACKAGECONFIG[compositorclient_nexus] = "-DPLUGIN_COMPOSITOR_IMPLEMENTATION='Nexus' \
    -DCOMPOSITORCLIENT_IMPLEMENTATION_PATH=${WPE_COMPOSITORCLIENT_IMPLEMENTATION_PATH} \
    -DCOMPOSITORCLIENT_IMPLEMENTATION_REPOSITORY=${WPE_COMPOSITORCLIENT_IMPLEMENTATION_REPOSITORY} \
    -DCOMPOSITORCLIENT_IMPLEMENTATION_VERSION=${WPE_COMPOSITORCLIENT_IMPLEMENTATION_VERSION} \
"
PACKAGECONFIG[vc4graphics] = "-DVC6=ON,,libdrm mesa"
# ----------------------------------------------------------------------------
